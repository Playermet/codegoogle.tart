@EntryPoint
def main(args: String[]) {
  testManualIteration();
  testForeach();
  return 0;
}

class Counter : Iterator[int] {
  private var value:int;
  private var end:int;
  
  def construct(end:int) {
    self.value = 0;
    self.end = end;
  }
  
  def next -> int or void {
    if (self.value < self.end) {
      return self.value++;
    } else {
      return;
    }
  }
}

def testManualIteration() {
  let ctr = Counter(5);
  Debug.assertTrue(ctr.next() isa int);
  Debug.assertTrue(ctr.next() isa int);
  Debug.assertTrue(ctr.next() isa int);
  Debug.assertTrue(ctr.next() isa int);
  Debug.assertTrue(ctr.next() isa int);
  Debug.assertFalse(ctr.next() isa int);
}

def testManualIteration2() {
  var ctr = Counter(5);
/*  Debug.assertTrue(ctr.next() == 0);
  Debug.assertTrue(ctr.next() == 1);
  Debug.assertTrue(ctr.next() == 2);
  Debug.assertTrue(ctr.next() == 3);
  Debug.assertTrue(ctr.next() == 4);
  Debug.assertFalse(ctr.next() == void());*/
}

def testForeach() {
  var sum = 0;
  for i in Counter(5) {
    sum += 1;
    Debug.assertTrue(sum < 6);
    Debug.writeLn(i.toString());
  }

  Debug.assertEq(5, sum);
}
